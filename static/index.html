<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City and District Info</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 h-screen flex items-center justify-center">
    <div class="text-center">
        <h1 class="text-3xl font-bold mb-6">City and District Information</h1>
        <div class="relative inline-block text-left">
            <input type="text" id="villeInput" placeholder="Enter city name" class="border p-2" />
            <div id="suggestionsBox" class="border p-2 mt-2 bg-white absolute w-full hidden"></div>
        </div>
        <select id="quartierSelect" class="border p-2 mt-4 block mx-auto">
            <option>Select a district</option>
        </select>
        <button id="showPriceBtn" class="bg-blue-500 text-white p-2 mt-4">Show Price</button>
        <div id="priceDisplay" class="mt-4"></div>
    </div>

    <script src="script.js"></script>
</body>
<script>
    const villeInput = document.getElementById('villeInput');
    const suggestionsBox = document.getElementById('suggestionsBox');
    const quartierSelect = document.getElementById('quartierSelect');
    const showPriceBtn = document.getElementById('showPriceBtn');
    const priceDisplay = document.getElementById('priceDisplay');

    function populateQuartiers(cityName) {
        fetch(`/api/quartiers/villes/${cityName}`)
            .then(response => response.json())
            .then(data => {
                quartierSelect.innerHTML = data.map(quartier => `<option>${quartier}</option>`).join('');
            });
    }

    villeInput.addEventListener('input', function() {
        if (!villeInput.value) {
            suggestionsBox.innerHTML = '';
            suggestionsBox.classList.add('hidden');
            return;
        }

        fetch(`/api/villes/${villeInput.value}`)
            .then(response => response.json())
            .then(data => {
                suggestionsBox.innerHTML = data.map(city => `<div class="suggestion-item cursor-pointer p-2 hover:bg-gray-200">${city}</div>`).join('');
                suggestionsBox.classList.remove('hidden');
                document.querySelectorAll('.suggestion-item').forEach(item => {
                    item.addEventListener('click', function() {
                        villeInput.value = this.textContent;
                        suggestionsBox.classList.add('hidden');
                        populateQuartiers(this.textContent);
                    });
                });
            });
    });

    showPriceBtn.addEventListener('click', function() {
        const selectedQuartier = quartierSelect.value;
        if (selectedQuartier) {
            fetch(`/api/prices/villes/${villeInput.value}/quartiers/${selectedQuartier}`)
                .then(response => response.json())
                .then(price => {
                    priceDisplay.textContent = `Price: ${price}`;
                });
        }
    });

    document.addEventListener('click', function(event) {
        if (event.target !== villeInput) {
            suggestionsBox.classList.add('hidden');
        }
    });
</script>
</html>
